{% extends "base.html" %}
{% block title %}Domovra — Paramètres{% endblock %}

{% block content %}
<div class="wrap" data-page="settings">

    <!-- Onglets -->
    <nav class="tabs" role="tablist" aria-label="Catégories de paramètres">
        <button class="tab" data-tab="appearance" aria-selected="true">Apparence</button>
        <button class="tab" data-tab="stock">Produits & Stocks</button>
        <button class="tab" data-tab="toasts">Notifications</button>
        <button class="tab" data-tab="journal">Journal</button>
        <button class="tab" data-tab="locations">Emplacements</button>
        <button class="tab" data-tab="admindb">Admin DB</button>
        <button class="tab" data-tab="advanced">Avancés</button>
    </nav>

    <form method="post" action="{{ BASE }}settings/save">

        <section class="panel card" data-panel="appearance">
            {% include "tools/appearance.html" %}
        </section>

        <section class="panel card" data-panel="stock" hidden>
            {% include "tools/stock.html" %}
        </section>

        <section class="panel card" data-panel="toasts" hidden>
            {% include "tools/toasts.html" %}
        </section>

        <section class="panel card" data-panel="journal" hidden>
            {% include "tools/journal.html" %}
        </section>

        <section class="panel card" data-panel="locations" hidden>
            {% include "tools/_locations_full.html" %}
        </section>

        <section class="panel card" data-panel="admindb" hidden>
            {% include "tools/admindb.html" %}
        </section>

        <section class="panel card" data-panel="advanced" hidden>
            {% include "tools/advanced.html" %}
        </section>

        <div class="row" style="justify-content:flex-end">
            <button class="secondary">Enregistrer</button>
        </div>
    </form>
</div>

<style>
    .tabs {
        display: flex;
        gap: .5rem;
        margin: 0 0 1rem 0;
        flex-wrap: wrap
    }

    .tab {
        padding: .45rem .75rem;
        border-radius: .75rem;
        border: 1px solid var(--line);
        background: transparent;
        cursor: pointer
    }

    .tab[aria-selected="true"] {
        background: rgba(255, 255, 255, .06)
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    (function () {
        const tabs = document.querySelectorAll('.tabs .tab');
        const panels = document.querySelectorAll('.panel');
        const KEY = 'settingsActiveTab';
        function show(tab) {
            tabs.forEach(t => t.setAttribute('aria-selected', t.dataset.tab === tab ? 'true' : 'false'));
            panels.forEach(p => p.hidden = p.dataset.panel !== tab);
            const u = new URL(location.href); u.searchParams.set('tab', tab); history.replaceState(null, '', u);
            localStorage.setItem(KEY, tab);
        }
        tabs.forEach(t => t.addEventListener('click', () => show(t.dataset.tab)));
        const urlTab = new URL(location.href).searchParams.get('tab');
        show(urlTab || localStorage.getItem(KEY) || 'appearance');
    })();
</script>
{% endblock %}