{% extends "base.html" %}


{% elif tab == 'relations' %}
<h3>Références sortantes (FK de {{ table }} vers d'autres)</h3>
{% if fks and fks|length>0 %}
<ul>
    {% for fk in fks %}
    <li><code>{{ table }}</code> ({{ fk.from }}) → <a
            href="{{ BASE }}admin/db/table/{{ fk.table }}?tab=data"><code>{{ fk.table }}</code></a> ({{ fk.to }})</li>
    {% endfor %}
</ul>
{% else %}
<div class="muted">Aucune.</div>
{% endif %}


<h3>Références entrantes (tables qui pointent vers {{ table }})</h3>
{% if rev and rev|length>0 %}
<ul>
    {% for r in rev %}
    <li><a href="{{ BASE }}admin/db/table/{{ r.from }}?tab=data"><code>{{ r.from }}</code></a> ({{ r.from }}) →
        <code>{{ table }}</code> ({{ r.to }})</li>
    {% endfor %}
</ul>
{% else %}
<div class="muted">Aucune.</div>
{% endif %}


{% elif tab == 'console' %}
<form method="post" action="{{ BASE }}admin/db/console/{{ table }}" class="console">
    <textarea name="sql" rows="6"
        placeholder="Ex: SELECT * FROM {{ table }} LIMIT 10">{{ console_sql or '' }}</textarea>
    <div class="muted">Autorisé : SELECT / PRAGMA / EXPLAIN uniquement.</div>
    <button class="btn" type="submit">Exécuter</button>
</form>


{% if console_err %}
<div class="error">Erreur: {{ console_err }}</div>
{% elif console_rows is defined %}
{% if console_rows and console_rows|length>0 %}
<div class="table-wrapper horizontal-scroll">
    <table class="data-table compact">
        <thead>
            <tr>
                {% for c in console_cols %}<th>{{ c }}</th>{% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for r in console_rows %}
            <tr>{% for c in console_cols %}<td class="mono">{{ r[c] }}</td>{% endfor %}</tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="muted">(Résultat vide)</div>
{% endif %}
{% endif %}
{% endif %}
</section>


<style>
    .tabs {
        display: flex;
        gap: .25rem;
        margin: .5rem 0 1rem;
        flex-wrap: wrap;
    }

    .tab {
        padding: .35rem .6rem;
        border: 1px solid var(--border);
        border-bottom: none;
        border-radius: .5rem .5rem 0 0;
        text-decoration: none;
        background: var(--bg);
    }

    .tab.active {
        font-weight: 600;
        box-shadow: inset 0 -2px 0 0 var(--border);
    }

    .toolbar {
        display: flex;
        gap: .5rem;
        align-items: center;
        flex-wrap: wrap;
        margin: .5rem 0;
    }

    .toolbar input[type="search"] {
        min-width: 200px;
    }

    .grid-form {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: .5rem;
        margin-top: .5rem;
    }

    .grid-form label {
        display: flex;
        flex-direction: column;
        gap: .25rem;
        font-size: .9rem;
    }

    .horizontal-scroll {
        overflow-x: auto;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .data-table th,
    .data-table td {
        padding: .5rem .6rem;
        border-bottom: 1px solid var(--border);
        vertical-align: top;
    }

    .data-table thead th {
        position: sticky;
        top: 0;
        background: var(--bg);
        z-index: 1;
    }

    .data-table.compact th,
    .data-table.compact td {
        padding: .35rem .5rem;
    }

    .pager {
        display: flex;
        gap: .5rem;
        align-items: center;
        margin-top: .75rem;
        flex-wrap: wrap;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: .35rem;
        padding: .45rem .7rem;
        border: 1px solid var(--border);
        border-radius: .5rem;
        text-decoration: none;
    }

    .btn.disabled {
        opacity: .5;
        pointer-events: none;
    }

    .actions {
        display: flex;
        gap: .5rem;
    }

    .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: .92em;
    }

    .fit {
        white-space: nowrap;
    }

    .console textarea {
        width: 100%;
        font-family: ui-monospace, monospace;
    }

    .error {
        color: var(--danger-fg, #b00020);
        background: rgba(176, 0, 32, .08);
        padding: .5rem .6rem;
        border-radius: .5rem;
        margin-top: .5rem;
    }
</style>
{% endblock %}